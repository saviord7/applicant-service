<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
  <title>Анкета поступающего</title>
  <style>
    h4 {
      background-color: #0d6efd88;
      padding: 8px;
      margin: 0;
    }
  </style>
  
</head>
<body  class="container">
  <form id=form1 class="row g-3" method="POST">
    <h2 class="text-center">Анкета поступающего</h2>
    <!-- <div class="form-text">We'll never share</div> -->
    <h4>Личные данные</h4>

    <div class="col-4"><input type="text" class="form-control col" id="Surname" placeholder="Фамилия"></div>
    <div class="col-4"><input type="text" class="form-control col" id="Name1" placeholder="Имя"></div>
    <div class="col-4"><input type="text" class="form-control col" id="Name2" placeholder="Отчество"></div>

    <div class="col-3">
      <label for="Sex" class="form-label">Пол</label>
      <select id="Sex" class="form-select">
        <option selected>Мужской</option>
        <option>Женский</option>
      </select>
    </div>
    <div class="col-3">
      <label for="BirthDate"             class="form-label">Дата Рождения</label>
      <input  id="BirthDate" type="date" class="form-control col" >
    </div>

    <h4>Образование</h4>

    <div class="col-3">
      <label for="УРОВЕНЬ_ДИПЛОМА" class="form-label">Уровень образования</label>
      <select id="УРОВЕНЬ_ДИПЛОМА" class="form-select">
        <option>Нет</option>
        <option selected>Среднее</option>
        <option>Среднее профессиональное</option>
        <option>Высшее</option>
        <option>Высшее профессиональное</option>
        <option>Другое</option>
      </select>
    </div>
    <div class="col-3">
      <label for="" class="form-label">Курс (если применимо)</label>
      <select id="" class="form-select">
        <option selected>-</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>6</option>
      </select>
    </div>
    <div class="col-3">
      <label for="ForeignLanguadge" class="form-label">Иностранный Язык</label>
      <select id="ForeignLanguadge" class="form-select">
        <option value=0>Другое</option>
        <option selected>Английский</option>
        <option>Русский</option>
        <option>Немецкий</option>
        <option>Французский</option>
      </select>
    </div>
    
    <div class="col-12 form-check">
      <input type="checkbox" class="form-check-input" id="ЕСТЬ_АТТЕСТАТ_С_ОТЛИЧИЕМ">
      <label class="form-check-label" for="ЕСТЬ_АТТЕСТАТ_С_ОТЛИЧИЕМ">Есть Аттестат С Отличием</label>
    </div>
    <div class="col-12 form-check">
      <input type="checkbox" class="form-check-input" id="ЕСТЬ_ДИПЛОМ_С_ОТЛИЧИЕМ">
      <label class="form-check-label" for="ЕСТЬ_ДИПЛОМ_С_ОТЛИЧИЕМ">Есть Диплом С Отличием</label>
    </div>

    <h4>Достижения</h4>

    <div class="col-3">
      <label for="БАЛЛ_ЗА_ДОСТИЖЕНИЯ"             class="form-label">Балл За Достижения</label>
      <input  id="БАЛЛ_ЗА_ДОСТИЖЕНИЯ" type="number" min=0 max=10 value=0 class="form-control col" >
    </div>
    <div class="col-3">
      <label for="БАЛЛ_ОЛИМПИАДЫ_И_КОНКУРСЫ"             class="form-label">Балл За Олимпиады и Конкурсы</label>
      <input  id="БАЛЛ_ОЛИМПИАДЫ_И_КОНКУРСЫ" type="number" min=0 max=10 value=0 class="form-control col" >
    </div>
    <div class="col-3">
      <label for="ОЦЕНКА_ЗА_СОЧИНЕНИЕ"             class="form-label">Оценка За Сочинение </label>
      <input  id="ОЦЕНКА_ЗА_СОЧИНЕНИЕ" type="number" min=0 max=5 value=0 class="form-control col" >
    </div>

    <h4>Баллы ЕГЭ</h4>

    <label class="col-2">1 приоритет</label>
    <div class="col-7">
      <select id="НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ПРЕДМЕТ_1_ПРИОРИТЕТ" class="form-select col-5">
        <option>Английский язык</option>
        <option>Информатика</option>
        <option>Математика</option>
        <option>Обществознание</option>
        <option>Русский язык</option>
        <option>Физика</option>
        <option>Химия</option>
      </select>
    </div>
    <div class="col-2">
      <input  id="НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ОЦЕНКА_1" type="number" min=0 max=100 value=0 class="form-control" >
    </div>

    <label class="col-2">2 приоритет</label>
    <div class="col-7">
      <select id="НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ПРЕДМЕТ_2_ПРИОРИТЕТ" class="form-select col-5">
        <option>Английский язык</option>
        <option>Информатика</option>
        <option>Математика</option>
        <option>Обществознание</option>
        <option>Русский язык</option>
        <option>Физика</option>
        <option>Химия</option>
      </select>
    </div>
    <div class="col-2">
      <input  id="НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ОЦЕНКА_2" type="number" min=0 max=100 value=0 class="form-control" >
    </div>
    
    <label class="col-2">3 приоритет</label>
    <div class="col-7">
      <select id="НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ПРЕДМЕТ_3_ПРИОРИТЕТ" class="form-select col-5">
        <option>Английский язык</option>
        <option>Информатика</option>
        <option>Математика</option>
        <option>Обществознание</option>
        <option>Русский язык</option>
        <option>Физика</option>
        <option>Химия</option>
      </select>
    </div>
    <div class="col-2">
      <input  id="НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ОЦЕНКА_3" type="number" min=0 max=100 value=0 class="form-control" >
    </div>

    <div class="col-2">
      <label for="НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_БАЛЛ"             class="form-label">Общий балл</label>
    </div>
    <div class="col-7"></div>
    <div class="col-2">
      <input  id="НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_БАЛЛ" type="number" min=0 max=305 value=0 class="form-control col" readonly>
    </div>

    <h4>Прочее</h4>

    <div class="col-3">
      <label for="StudentPreferences" class="form-label">Поступление в ЛЭТИ приоритетно</label>
      <select id="StudentPreferences" class="form-select">
        <option selected>Да</option>
        <option>Не определился</option>
        <option>Нет</option>
      </select>
    </div>
    <div class="col-3">
      <label for="IsTargetedRecruitment" class="form-label">Рассматривать целевое обучение</label>
      <select id="IsTargetedRecruitment" class="form-select">
        <option selected>Нет</option>
        <option>Да</option>
      </select>
    </div>
    <div class="col-3">
      <label for="ОБЩЕЖИТИЕ_ТИП_ЗАСЕЛЕНИЯ" class="form-label">Общежитие</label>
      <select id="ОБЩЕЖИТИЕ_ТИП_ЗАСЕЛЕНИЯ" class="form-select">
        <option selected>Не требуется</option>
        <option>Только регистрация</option>
        <option>Требуется</option>
      </select>
    </div>

    <button type="submit" class="btn btn-primary">Отправить</button>
  </form>
  
  <div id="t_results" hidden>
    <h2 class="text-center">Результаты</h2>
    <table class="table table-sm table-striped table-hover">
    <thead>
      <tr>
        <th scope="col">Код</th>
        <th scope="col">Специальность</th>
        <th scope="col">Предп. средняя оценка</th>
      </tr>
    </thead>
    <tbody id=t_results_body>
    </tbody>
  </div>

  <script>
    const API_ENDPOINT = 'http://localhost:5000/api/predict'
  
    document.body.onload = Init

    const GradeElements =  [
      'НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ОЦЕНКА_1', 
      'НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ОЦЕНКА_2', 
      'НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_ОЦЕНКА_3'
    ]

    function Init() {
      let list = document.querySelectorAll('input,select')
      for (let i of list) {
        i.name = i.id
      }

      for (let i of GradeElements) {
        document.getElementById(i).onchange = onGradeChange
      }

      document.body.onkeydown = function (event) {
        if(event.key == 'Enter') {
          event.srcElement.blur()
          return false
        }
      }
      
      form1.onsubmit = onSubmit
    }

    function onGradeChange() {
      document.getElementById('НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_БАЛЛ').value = 0

      let sum = 0
      for (let i of GradeElements) {
        sum += +document.getElementById(i).value
      }

      document.getElementById('НАПРАВЛЕНИЕ_В_ПРИКАЗЕ_БАЛЛ').value = +sum
    }
    
    var log = console.log
    
    const exclude = [
      "Surname",
      "Name1",
      "Name2",
      "Sex",
      "BirthDate",
      "ForeignLanguadge",
      "StudentPreferences",
      "IsTargetedRecruitment",
    ]
    
    function onSubmit(e) {
      var formData = new FormData(document.getElementById("form1"))
      var tobj = {}
      
      formData.forEach(function(value, key){
        if( exclude.indexOf(key) == -1 )
          tobj[key] = value
      });
      
      var json = {data: tobj}
      log(json)
      
      e.stopPropagation() 
      
      fetch(API_ENDPOINT, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(json)
      })
        .then( response => {
          return response.json()
        })
        .then( json => {
          console.log(json)
          
          for(i of json.prediction) {
            t_results_body.innerHTML += `
            <tr>
              <td>${i[1]}
              <td>${trainingDirections[i[1]]}
              <td>${parseFloat(i[0]).toFixed(2)}
            `
          }
          
          form1.hidden = true
          t_results.hidden = false
          // document.body.innerHTML = html     
        })
        .catch( e => log(e))
      
           
      return false
    }
    
    const trainingDirections = {
      "10.05.01": "Компьютерная безопасность",
      "27.03.02": "Управление качеством",
      "42.03.01": "Реклама и связи с общественностью",
      "28.03.01": "Нанотехнологии и микросистемная техника",
      "45.03.02": "Лингвистика",
      "12.03.04": "Биотехнические системы и технологии",
      "38.03.02": "Менеджмент",
      "27.03.03": "Системный анализ и управление",
      "09.03.04": "Программная инженерия",
      "20.03.01": "Техносферная безопасность",
      "38.03.01": "Экономика",
      "11.03.02": "Инфокоммуникационные технологии и системы связи",
      "27.03.04": "Управление в технических системах",
      "11.03.03": "Конструирование и технология электронных средств",
      "09.03.02": "Информационные системы и технологии",
      "13.03.02": "Электроэнергетика и электротехника",
      "12.03.01": "Приборостроение",
      "09.03.01": "Информатика и вычислительная техника. Искусственный интеллект",
      "01.03.02": "Прикладная математика и информатика",
      "27.03.05": "Инноватика",
      "11.03.04": "Электроника и наноэлектроника. Оптоэлектроника и фотоника",
      "11.03.01": "Радиотехника. Интеллектуальные радиотехнические системы"
    }
  </script>

</body>
</html>